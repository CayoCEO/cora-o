<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Heart Scene – Final Ajustado</title>
<style>
html,body{
  margin:0;
  padding:0;
  height:100%;
  background:#050510;
  overflow:hidden;
  touch-action:none;
}
#app{position:fixed;inset:0}
.hint{
  position:fixed;
  left:50%;
  bottom:10px;
  transform:translateX(-50%);
  font:13px system-ui;
  color:rgba(255,255,255,.7);
  background:rgba(0,0,0,.25);
  padding:6px 12px;
  border-radius:999px;
  backdrop-filter:blur(8px);
  border:1px solid rgba(255,255,255,.12);
  z-index:10
}
</style>
</head>
<body>

<div id="app"></div>
<div class="hint">Arraste • Pinça • WASD / Toque</div>

<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
<script>
/* ================= CONFIG ================= */
const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
const MOVE_SPEED = isMobile ? 0.035 : 0.05;
const DAMPING = 0.82;

/* ================= SCENE ================= */
const scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x050510, 4, 22);

const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.01, 300);
camera.position.set(0, 1.2, 9);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(Math.min(2, devicePixelRatio));
renderer.setClearColor(0x050510, 1);
document.getElementById('app').appendChild(renderer.domElement);

/* ================= GLOW ================= */
function glowTexture(size=256){
  const c=document.createElement('canvas');
  c.width=c.height=size;
  const g=c.getContext('2d');
  const r=size/2;
  const grad=g.createRadialGradient(r,r,0,r,r,r);
  grad.addColorStop(0,'rgba(255,255,255,1)');
  grad.addColorStop(.4,'rgba(255,80,200,.9)');
  grad.addColorStop(.75,'rgba(255,0,140,.4)');
  grad.addColorStop(1,'rgba(255,0,120,0)');
  g.fillStyle=grad;
  g.fillRect(0,0,size,size);
  return new THREE.CanvasTexture(c);
}
const glow = glowTexture();

/* ================= HEART ================= */
function heart2D(t){
  return{
    x:16*Math.sin(t)**3,
    y:13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t)
  };
}

function createHeart(count){
  const pos=new Float32Array(count*3);
  const col=new Float32Array(count*3);
  const c1=new THREE.Color('#ff006e');
  const c2=new THREE.Color('#ff4fd8');

  for(let i=0;i<count;i++){
    const t=Math.random()*Math.PI*2;
    const p=heart2D(t);

    // contorno forte + volume REAL
    const r=Math.pow(Math.random(),0.18);

    const x=p.x*(1-r);
    const y=(p.y+4)*(1-r);

    // Z totalmente independente (gordura real)
    const z=(Math.random()-0.5)*12*(1-r);

    pos[i*3]=x*0.19;
    pos[i*3+1]=y*0.19;
    pos[i*3+2]=z*0.19;

    const c=c1.clone().lerp(c2,Math.random());
    col[i*3]=c.r; col[i*3+1]=c.g; col[i*3+2]=c.b;
  }
  return{pos,col};
}

const heartCount = isMobile?26000:60000;
const heartData = createHeart(heartCount);

const heartGeo = new THREE.BufferGeometry();
heartGeo.setAttribute('position',new THREE.BufferAttribute(heartData.pos,3));
heartGeo.setAttribute('color',new THREE.BufferAttribute(heartData.col,3));

const heart = new THREE.Points(
  heartGeo,
  new THREE.PointsMaterial({
    size:isMobile?0.085:0.07,
    map:glow,
    transparent:true,
    vertexColors:true,
    blending:THREE.AdditiveBlending,
    depthWrite:false
  })
);
scene.add(heart);

/* ================= TEXT RINGS (5 frases legíveis) ================= */
function textSprite(text){
  const c=document.createElement('canvas');
  c.width=1024;
  c.height=256;
  const g=c.getContext('2d');

  g.clearRect(0,0,c.width,c.height);
  g.font='bold 96px Arial';
  g.textAlign='center';
  g.textBaseline='middle';
  g.fillStyle='#ff4fd8';
  g.shadowColor='#ff4fd8';
  g.shadowBlur=30;
  g.fillText(text,c.width/2,c.height/2);

  const tex=new THREE.CanvasTexture(c);
  tex.minFilter=THREE.LinearFilter;
  return new THREE.SpriteMaterial({map:tex,transparent:true});
}

const rings=[];
const ringTexts=[
  "EU TE AMO PARA SEMPRE",
  "VOCÊ É MEU MUNDO",
  "MINHA VIDA É VOCÊ",
  "PARA TODO O SEMPRE",
  "MEU CORAÇÃO É SEU"
];

ringTexts.forEach((txt,i)=>{
  const sprite=new THREE.Sprite(textSprite(txt));
  sprite.scale.set(isMobile?4.2:5.5, isMobile?1.1:1.4,1);
  sprite.position.set(0,-1.0-i*0.55,0);
  sprite.userData.speed=(i%2===0?1:-1)*(0.0015-i*0.0002);
  rings.push(sprite);
  scene.add(sprite);
});

/* ================= CONTROLES ================= */
let yaw=0,pitch=0;
let velocity=new THREE.Vector3();
let dragging=false,lx=0,ly=0;
const keys={};

addEventListener('mousedown',e=>{dragging=true;lx=e.clientX;ly=e.clientY});
addEventListener('mousemove',e=>{
  if(!dragging)return;
  yaw-=(e.clientX-lx)*0.002;
  pitch-=(e.clientY-ly)*0.002;
  pitch=Math.max(-1.2,Math.min(1.2,pitch));
  lx=e.clientX;ly=e.clientY;
});
addEventListener('mouseup',()=>dragging=false);

addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);
addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);

/* ================= ANIMATE ================= */
let t=0;
function animate(){
  t+=0.035;

  heart.scale.setScalar(1+Math.sin(t)*0.025);

  // frases girando lentamente
  rings.forEach(r=>r.rotation.y+=r.userData.speed);

  // direção correta (W = frente)
  const forward=new THREE.Vector3(
    -Math.sin(yaw),
    0,
    -Math.cos(yaw)
  );
  const right=new THREE.Vector3(
    Math.cos(yaw),
    0,
    -Math.sin(yaw)
  );

  if(keys.w) velocity.addScaledVector(forward,MOVE_SPEED);
  if(keys.s) velocity.addScaledVector(forward,-MOVE_SPEED);
  if(keys.a) velocity.addScaledVector(right,-MOVE_SPEED);
  if(keys.d) velocity.addScaledVector(right,MOVE_SPEED);
  if(keys.e) velocity.y+=MOVE_SPEED;
  if(keys.q) velocity.y-=MOVE_SPEED;

  camera.position.add(velocity);
  velocity.multiplyScalar(DAMPING);

  camera.rotation.set(pitch,yaw,0,'YXZ');

  renderer.render(scene,camera);
  requestAnimationFrame(animate);
}
animate();

/* ================= RESIZE ================= */
addEventListener('resize',()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
